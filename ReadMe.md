# Чому використання дистрибутиву alpine не найкраща ідея?

При виборі оптимального та мінімалістичного Docker image частою порадою є використання Alpine Linux. Здається, що це розумне рішення, адже дистрибутив справді легкий і мінімалістичний. Проте виявляється, все не так просто. Ви можете стикнутися з проблемою, коли ваша програма працює значно повільніше, ніж очікувалося.

Відмінності Alpine полягають у використанні musl як стандартної бібліотеки C, на відміну від більшості дистрибутивів, які використовують Glibc. Основна проблема в тому, що musl має проблеми при високих багатопоточних навантаженнях через використання аллокатора пам'яті, який має фундаментальні недоліки в дизайні.

Хоча в релізі musl-1.2.1 був впроваджений mallocng для заміни оригінального аллокатора, він все ще працює повільно. Декілька можливих вирішень цієї проблеми включають заміну аллокатора на jemalloc або mimalloc. Однак це може бути складним завданням, особливо для jemalloc. Комбінація musl + mimalloc показала гарні результати, працюючи навіть ефективніше за glibc при збільшенні кількості потоків.

Інший простий спосіб - просто замінити Alpine на дистрибутив, що використовує Glibc. Один із варіантів - Debian buster slim. Debian buster slim використовує Glibc, що може допомогти уникнути проблем, пов'язаних із швидкістю та продуктивністю, які можуть виникнути в Alpine з musl. Debian Slim надає стабільну робочу середу з гнучкістю конфігурації, і його використання може бути особливо корисним в сценаріях, де критична продуктивність і багатопоточність.
